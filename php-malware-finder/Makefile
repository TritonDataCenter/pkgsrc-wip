# $NetBSD: Makefile,v 1.1 2015/07/14 11:10:49 ahp-nils Exp $

DISTNAME=	${GHCOMMIT}
PKGNAME=	php-malware-finder-${VERSION}
CATEGORIES=	security
MASTER_SITES=	${MASTER_SITE_GITHUB:=nbs-system/php-malware-finder/archive/}

MAINTAINER=	nils@NetBSD.org
HOMEPAGE=	${MASTER_SITE_GITHUB:=nbs-system/php-malware-finder/}
COMMENT=	Detect potentially malicious PHP files
LICENSE=	gnu-gpl-v3

VERSION=	0.1.1.20151126
GHCOMMIT=	ccbefed99a639c5c91463bf3edc343cc13b65d36
DEPENDS+=	yara-[0-9]*:../../security/yara
WRKSRC=		${WRKDIR}/php-malware-finder-${GHCOMMIT}
NO_BUILD=	yes
USE_LANGUAGES=	# none
USE_TOOLS+=	bash:run
EGDIR=		${PREFIX}/share/examples/php-malware-finder
PKG_SYSCONFSUBDIR=	phpmalwarefinder
CONF_FILES=	${EGDIR}/malwares.yara ${PKG_SYSCONFDIR}/malwares.yara \
		${EGDIR}/whitelist.yara ${PKG_SYSCONFDIR}/whitelist.yara
INSTALLATION_DIRS+=	bin ${EGDIR} share/php-malware-finder ${DOCDIR}
AUTO_MKDIRS=	yes
DOCDIR=		share/doc/php-malware-finder

REPLACE_INTERPRETER+=	bash
REPLACE.bash.old=	.*sh[^ ]*
REPLACE.bash.new=	${TOOLS_PATH.bash}
REPLACE_FILES.bash=	${WRKSRC}/phpmalwarefinder

SUBST_CLASSES+=	install
SUBST_STAGE.install=	pre-install
SUBST_MESSAGE.install=	correcting installation path
SUBST_FILES.install=	${WRKSRC}/phpmalwarefinder
SUBST_SED.install=	-e 's,/etc,${PREFIX}/etc,g'

do-install:
	${INSTALL_SCRIPT} ${WRKSRC}/phpmalwarefinder ${DESTDIR}${PREFIX}/bin
	${INSTALL_DATA} ${WRKSRC}/malwares.yara ${DESTDIR}${EGDIR}
	${INSTALL_DATA} ${WRKSRC}/whitelist.yara ${DESTDIR}${EGDIR}
	${INSTALL_DATA} ${WRKSRC}/generate_whitelist.py ${DESTDIR}${PREFIX}/share/php-malware-finder/
	${INSTALL_DATA} ${WRKSRC}/poc.py ${DESTDIR}${PREFIX}/share/php-malware-finder/
	${INSTALL_DATA} ${WRKSRC}/LICENSE ${DESTDIR}${PREFIX}/${DOCDIR}
	${INSTALL_DATA} ${WRKSRC}/README.md ${DESTDIR}${PREFIX}/${DOCDIR}

# url2pkg-marker (please do not remove this line.)
.include "../../mk/bsd.pkg.mk"
