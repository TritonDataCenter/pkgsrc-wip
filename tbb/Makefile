# $NetBSD$
#
###########################################################
#                  Generated by fbsd2pkg                  #
#              Thu Sep 13 13:15:15 CDT 2018               #
###########################################################

###########################################################
# Unconverted and partially converted FreeBSD port syntax:
# Some of this may be useful for NetBSD and FreeBSD builds

#SUB_FILES=	tbb.pc
#SUB_LIST=	prefix="${PREFIX}" \
#		name="${PORTNAME}" \
#		description="${COMMENT}" \
#		version="${PV}"
#USE_LDCONFIG=	yes
#post-extract:
#.if ${CC_BASENAME} != ${COMPILER_TYPE}
#	@${LN} -sf \${OPSYS}.${COMPILER_TYPE}.inc ${WRKSRC}/build/\${OPSYS}.${CC_BASENAME}.inc
#.endif
#	@${CP} ${FILESDIR}/version_info_\${OPSYS}.sh ${WRKSRC}/build/

# Best guess translation of REINPLACE above.  Replace 1 with a
# meaningful name.  Assuming post-patch: Change if necessary.
#SUBST_CLASSES+=		1
#SUBST_STAGE.1=	post-patch
#SUBST_SED.1+=	-e '/^CONLY =/s|^CONLY =.*|CONLY = ${CC}|'
#SUBST_SED.1+=	-e '/^CPLUS =/s|^CPLUS =.*|CPLUS = ${CXX}|'
#SUBST_FILES.1+=	${WRKSRC}/build/FreeBSD.${COMPILER_TYPE}.inc

DISTNAME=	tbb-${PV}
CATEGORIES=	devel
MASTER_SITES=	${MASTER_SITE_GITHUB:=01org/}
GITHUB_PROJECT=	tbb
GITHUB_TAG=	${PV:S/./_U/}

MAINTAINER=	bacon@NetBSD.org
HOMEPAGE=	http://threadingbuildingblocks.org/
COMMENT=	Library that provides thread building blocks
LICENSE=	apache-2.0

ONLY_FOR_PLATFORM=	 *-*-aarch64 *-*-x86_64 *-*-earmv6 *-*-earmv7 *-*-i386

USE_LANGUAGES=	c c++
USE_TOOLS+=	gmake pax
BUILD_TARGET=	default

PV=		2018.5

.include "../../mk/bsd.prefs.mk"

.if ${OPSYS} == Linux
BUILD_OPSYS=	linux
.else
BUILD_OPSYS=	${OPSYS}
.endif

INSTALLATION_DIRS=	include/tbb lib share/doc/tbb

do-install:
	cd ${WRKSRC}; \
	${INSTALL_LIB} build/${BUILD_OPSYS}*release/libtbb.so.2 \
		${DESTDIR}${PREFIX}/lib; \
	${LN} -sf libtbb.so.2 \
		${DESTDIR}${PREFIX}/lib/libtbb.so; \
	${INSTALL_LIB} build/${BUILD_OPSYS}*release/libtbbmalloc.so.2 \
		${DESTDIR}${PREFIX}/lib; \
	${LN} -sf libtbbmalloc.so.2 \
		${DESTDIR}${PREFIX}/lib/libtbbmalloc.so; \
	${INSTALL_LIB} build/${BUILD_OPSYS}*release/libtbbmalloc_proxy.so.2 \
		${DESTDIR}${PREFIX}/lib; \
	${LN} -sf libtbbmalloc_proxy.so.2 \
		${DESTDIR}${PREFIX}/lib/libtbbmalloc_proxy.so; \
	cd include/tbb/ && pax -rw . ${DESTDIR}${PREFIX}/include/tbb/
	cd ${WRKSRC}/doc/html && pax -rw . ${DESTDIR}${PREFIX}/share/doc/tbb

post-install:
	${RM} ${DESTDIR}${PREFIX}/include/tbb/*.orig
	${CHMOD} -R g-w ${DESTDIR}${PREFIX}
# 	${INSTALL_DATA} ${WRKDIR}/tbb.pc ${DESTDIR}${PREFIX}/libdata/pkgconfig

.include "../../mk/bsd.pkg.mk"
